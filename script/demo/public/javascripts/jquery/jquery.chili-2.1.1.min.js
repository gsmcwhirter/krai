(function(A){ChiliBook={version:"2.1",automatic:true,automaticSelector:"code",lineNumbers:!true,codeLanguage:function(B){var C=A(B).attr("class");return C?C:""},recipeLoading:true,recipeFolder:"",replaceSpace:"&#160;",replaceTab:"&#160;&#160;&#160;&#160;",replaceNewLine:"&#160;<br/>",selectionStyle:["position:absolute; z-index:3000; overflow:scroll;","width:16em;","height:9em;","border:1px solid gray;","padding:15px;","background-color:yellow;"].join(" "),defaultReplacement:'<span class="$0">$$</span>',recipes:{},queue:{},unique:function(){return(new Date()).valueOf()}};A.fn.chili=function(N){var F=A.extend({},ChiliBook,N||{});function B(P,R,d){function W(j,i){var h=[];for(var k in j[i]){h.push(c(j,i,k))}return h}function c(k,h,l){var i=k[h][l];var j=(typeof i._match=="string")?i._match:i._match.source;return{recipe:k,blockName:h,stepName:l,exp:"("+j+")",length:1+(j.replace(/\\./g,"%").replace(/\[.*?\]/g,"%").match(/\((?!\?)/g)||[]).length,replacement:i._replace?i._replace:F.defaultReplacement}}function g(h){var l=1;var n=[];for(var k=0;k<h.length;k++){var o=h[k].exp;o=o.replace(/\\\\|\\(\d+)/g,function(i,q){return !q?i:"\\"+(l+1+parseInt(q,10))});n.push(o);l+=h[k].length}var j="((?:\\s|\\S)*?)";var p="((?:\\s|\\S)+)";var m="(?:"+n.join("|")+")";m=j+m+"|"+p;return new RegExp(m,R._case?"g":"gi")}function b(h){return h.replace(/&/g,"&amp;").replace(/</g,"&lt;")}function S(h){return h.replace(/ +/g,function(i){return i.replace(/ /g,V)})}function Y(h){h=b(h);if(V){h=S(h)}return h}function Q(h,i){return B(h,i)}function a(i,j,h){return B(i,j,h)}function U(k,n,j,o){var i=F.replaceSpace;var l=c(n,j,o);var h=[l];var m=k.replace(g(h),function(){return Z.apply({steps:h},arguments)});return m}function O(p,j,i){if(!j){return Y(p)}var h=j.split("/");var o="";var q="";var s="";switch(h.length){case 1:o=h[0];break;case 2:o=h[0];q=h[1];break;case 3:o=h[0];q=h[1];s=h[2];break;default:return Y(p)}function l(w){var u=M(w);var v=F.recipes[u];if(!v){throw {msg:"recipe not available"}}return v}try{var r;if(""==s){if(""==q){if(""==o){}else{r=l(o);return Q(p,r)}}else{if(""==o){r=i.recipe}else{r=l(o)}if(!(q in r)){return Y(p)}return a(p,r,q)}}else{if(""==o){r=i.recipe}else{r=l(o)}if(""==q){q=i.blockName}if(!(q in r)){return Y(p)}if(!(s in r[q])){return Y(p)}return U(p,r,q,s)}}catch(n){if(n.msg&&n.msg=="recipe not available"){var m="chili_"+F.unique();if(F.recipeLoading){var t=M(o);if(!F.queue[t]){try{F.queue[t]=[{cue:m,subject:p,module:j,context:i}];A.getJSON(t,function(u){F.recipes[t]=u;var x=F.queue[t];for(var v=0,y=x.length;v<y;v++){var w=O(x[v].subject,x[v].module,x[v].context);if(F.replaceTab){w=w.replace(/\t/g,F.replaceTab)}if(F.replaceNewLine){w=w.replace(/\n/g,F.replaceNewLine)}A("#"+x[v].cue).replaceWith(w)}})}catch(k){alert("the recipe for '"+o+"' was not found in '"+t+"'")}}else{F.queue[t].push({cue:m,subject:p,module:j,context:i})}return'<span id="'+m+'">'+Y(p)+"</span>"}return Y(p)}else{return Y(p)}}}function X(j,i){var h=i.replace(/(<span\s+class\s*=\s*(["']))((?:(?!__)\w)+\2\s*>)/ig,"$1"+j+"__$3");return h}function Z(){if(!arguments[0]){return""}var s=this.steps;var q=0;var p=2;var u=arguments[1];var n=arguments[arguments.length-3];if(!n){var l;while(l=s[q++]){var h=arguments;if(h[p]){var m="";if(A.isFunction(l.replacement)){var r=[];for(var o=0,t=l.length;o<t;o++){r.push(h[p+o])}r.push(h[h.length-2]);r.push(h[h.length-1]);m=l.replacement.apply({x:function(){var k=arguments[0];var j=arguments[1];var i={recipe:l.recipe,blockName:l.blockName};return O(k,j,i)}},r)}else{m=l.replacement.replace(/(\\\$)|(?:\$\$)|(?:\$(\d+))/g,function(i,k,j){if(k){return"$"}else{if(!j){return Y(h[p])}else{if(j=="0"){return l.stepName}else{return Y(h[p+parseInt(j,10)])}}}})}m=X(l.recipe._name,m);return Y(u)+m}else{p+=l.length}}}else{return Y(n)}}if(!d){d="_main";G(R)}if(!(d in R)){return Y(P)}var V=F.replaceSpace;var f=W(R,d);var T=g(f);var e=P.replace(T,function(){return Z.apply({steps:f},arguments)});return e}function C(P){if(document.createElement){var Q=document.createElement("style");Q.type="text/css";if(Q.styleSheet){Q.styleSheet.cssText=P}else{var O=document.createTextNode(P);Q.appendChild(O)}document.getElementsByTagName("head")[0].appendChild(Q)}}function G(T){var P=T._name;if(!F.queue[P]){var S=["/* Chili -- "+P+" */"];for(var O in T){if(O.search(/^_(?!main\b)/)<0){for(var U in T[O]){var R=T[O][U];if("_style" in R){if(R._style.constructor==String){S.push("."+P+"__"+U+" { "+R._style+" }")}else{for(var Q in R._style){S.push("."+P+"__"+Q+" { "+R._style[Q]+" }")}}}}}}S=S.join("\n");C(S);F.queue[P]=true}}function D(O){var R=F.codeLanguage(O);if(""!=R){var Q=M(R);if(F.recipeLoading){if(!F.queue[Q]){try{F.queue[Q]=[O];A.getJSON(Q,function(S){F.recipes[Q]=S;var U=F.queue[Q];for(var T=0,V=U.length;T<V;T++){J(U[T],Q)}})}catch(P){alert("the recipe for '"+R+"' was not found in '"+Q+"'")}}else{F.queue[Q].push(O)}J(O,Q)}else{J(O,Q)}}}function J(R,P){var S=F.recipes[P];if(!S){return }var Q=A(R);var O=Q.text();if(!O){return }O=O.replace(/\r\n?/g,"\n");if(Q.parent().is("pre")){if(!A.browser.safari){O=O.replace(/^\n/g,"")}}var T=B(O,S);if(F.replaceTab){T=T.replace(/\t/g,F.replaceTab)}if(F.replaceNewLine){T=T.replace(/\n/g,F.replaceNewLine)}R.innerHTML=T;if(A.browser.msie||A.browser.mozilla){E(R)}if(F.lineNumbers){K(R)}}function E(P){var O=null;A(P).parents().filter("pre").bind("mousedown",function(){O=this;if(A.browser.msie){document.selection.empty()}else{window.getSelection().removeAllRanges()}}).bind("mouseup",function(T){if(O&&(O==this)){O=null;var R="";if(A.browser.msie){R=document.selection.createRange().htmlText;if(""==R){return }R=L(R);var X='<textarea style="STYLE">'}else{R=window.getSelection().toString();if(""==R){return }R=R.replace(/\r/g,"").replace(/^# ?/g,"").replace(/\n# ?/g,"\n");var X='<pre style="STYLE">'}var W=A(X.replace(/\bSTYLE\b/,ChiliBook.selectionStyle)).appendTo("body").text(R).attr("id","chili_selection").click(function(){A(this).remove()});var V=T.pageY-Math.round(W.height()/2)+"px";var U=T.pageX-Math.round(W.width()/2)+"px";W.css({top:V,left:U});if(A.browser.msie){W[0].focus();W[0].select()}else{var Q=window.getSelection();Q.removeAllRanges();var S=document.createRange();S.selectNodeContents(W[0]);Q.addRange(S)}}})}function M(O){return F.recipeFolder+O+".js"}function H(){var O="";if(A.browser.msie){O=document.selection.createRange().htmlText}else{O=window.getSelection().toString()}return O}function L(O){do{var Q=ChiliBook.unique()}while(O.indexOf(Q)>-1);var R="";if(/<br/i.test(O)||/<li/i.test(O)){if(/<br/i.test(O)){O=O.replace(/\<br[^>]*?\>/ig,Q)}else{if(/<li/i.test(O)){O=O.replace(/<ol[^>]*?>|<\/ol>|<li[^>]*?>/ig,"").replace(/<\/li>/ig,Q)}}var P=A("<pre>").appendTo("body").hide()[0];P.innerHTML=O;R=A(P).text().replace(new RegExp(Q,"g"),"\r\n");A(P).remove()}return R}function K(T){function S(W,Z,Y,X){var a=X?"</span>":"";var V="";if(W){V="<li>"+X+Z+a+"</li>"}else{if(Y){V="<li>"+X+Y+a+"</li>"}}return V}function R(W,Y,X,Z){var V="";if(Z){V=Z}else{V=S(W,Y,X,"")}return V}var Q=A(T).html();var P=/<br>/.test(Q)?"<br>":"<BR>";var U="<li>"+F.replaceSpace+"</li>";var O=Q.replace(/(<span [^>]+>)((?:(?:&nbsp;|\xA0)<br>)+)(.*?)(<\/span>)/ig,"$2$1$3$4").replace(/(.*?)(<span .*?>)(.*?)(?:<\/span>(?:&nbsp;|\xA0)<br>|<\/span>)/ig,function(Y,b,X,a){if(/<br>/i.test(a)){var Z=b.split(P);var W=Z.pop();b=Z.join(P);var V=(b?b+P:"")+(W+a).replace(/((.*?)(?:&nbsp;|\xA0)<br>)|(.*)/ig,function(e,c,g,f){var d=S(c,g,f,X);return d});return V}else{return Y}}).replace(/(<li>.*?<\/li>)|((.*?)(?:&nbsp;|\xA0)<br>)|(.+)/ig,function(X,a,V,Z,Y){var W=R(V,Z,Y,a);return W}).replace(/<li><\/li>/ig,U);T.innerHTML="<ol>"+O+"</ol>"}function I(O){return A.map(O.split(""),function(Q,P){return" "+Q+" "+Q.charCodeAt(0)+" "}).join(" ")}this.each(function(){var O=A(this);O.trigger("chili.before_coloring");D(this);O.trigger("chili.after_coloring")});return this};A(function(){if(ChiliBook.automatic){A(ChiliBook.automaticSelector).chili()}})})(jQuery);